<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A Special Message For You</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --background-start: #ffe5e5;
        --background-end: #ffc6c6;
        --heart-color: #cd0a1a;
        --long-text-color: #5d4a4a;
      }

      body {
        margin: 0;
        height: 100vh;
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.5),
            rgba(248, 248, 248, 0.5)
          ),
          url("bg3.jpg"); /* Replace with your image URL */
        background-color: var(--background-start); /* Fallback color */
        background-size: auto;
        background-position: center;
        overflow: hidden;
        font-family: "Poppins", "Arial", sans-serif;
      }

      .container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #startButton {
        font-family: "Poppins", sans-serif;
        font-size: 1.5rem;
        padding: 15px 30px;
        border: 2px solid white;
        background-color: rgba(15, 150, 235, 0.7);
        color: white;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 100;
      }
      #startButton:hover {
        transform: scale(1.1);
        background-color: rgb(51, 114, 196);
      }
      #startButton.hidden {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.5);
      }

      .sticker {
        position: absolute;
        bottom: 30px;
        width: 150px;
        height: auto;
        animation: bounce 2s ease-in-out infinite;
        opacity: 0; /* Initially hidden */
        transition: opacity 1s ease-in-out;
      }
      .sticker.visible {
        opacity: 1;
      }

      #sticker-left {
        left: 30px;
      }

      #sticker-right {
        right: 30px;
      }

      .heart-particle {
        position: absolute;
        font-size: 16px;
        color: var(--heart-color);
        pointer-events: none;
        opacity: 0;
        transition: transform 3s cubic-bezier(0.25, 1, 0.5, 1),
          opacity 0.5s ease-out;
      }

      .long-message {
        position: absolute;
        width: 80%;
        max-width: 600px;
        top: 65%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        text-align: center;
        color: var(--long-text-color);
        font-family: "Dancing Script", cursive;
        font-size: 1.8rem;
        line-height: 1.6;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1.5s ease-in-out, transform 1.5s ease-in-out;
        background: rgba(8, 179, 236, 0.8);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 50;
        font: 1em "arial", sans-serif;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        animation: fadeIn 1.5s ease-in-out;
        font-size: 1.5rem;
      }

      .long-message.visible {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-15px);
        }
      }

      @media (max-width: 768px) {
        .sticker {
          width: 100px;
        }
        .long-message {
          font-size: 1.3rem;
          top: 68%;
        }
      }
    </style>
  </head>
  <body>
    <div id="container" class="container">
      <button id="startButton">Click me</button>

      <img
        id="sticker-left"
        class="sticker"
        src="Untitled.gif"
        alt="Cute sticker waving"
      />
      <img
        id="sticker-right"
        class="sticker"
        src="Untitled2.gif"
        alt="Cute sticker holding heart"
      />

      <div id="long-message-container" class="long-message"></div>

      <canvas id="textCanvas" style="display: none"></canvas>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("container");
        const longMessageContainer = document.getElementById(
          "long-message-container"
        );
        const leftSticker = document.getElementById("sticker-left");
        const rightSticker = document.getElementById("sticker-right");
        const startButton = document.getElementById("startButton");

        const SHORT_MESSAGE = "I ❤️ You KI KI";
        const LONG_MESSAGE =
          "Don't hurt yourself with overthinking. You are not alone. I will always be there for you. Take rest and sleep well sweetie.";

        startButton.addEventListener("click", () => {
          // Hide button and start the main animation
          startButton.classList.add("hidden");
          startAnimation();
        });

        function startAnimation() {
          // Make stickers appear
          leftSticker.classList.add("visible");
          rightSticker.classList.add("visible");

          const targetPoints = prepareShortMessageCoordinates();
          formShortMessage(targetPoints);

          const totalAnimationTime = targetPoints.length * 8; // Based on your 8ms delay
          // REVEAL IMMEDIATELY AFTER: The extra +3000 delay is removed.
          setTimeout(revealLongMessage, totalAnimationTime);
        }

        function prepareShortMessageCoordinates() {
          const canvas = document.getElementById("textCanvas");
          const ctx = canvas.getContext("2d");

          const canvasWidth = window.innerWidth;
          const canvasHeight = window.innerHeight;
          canvas.width = canvasWidth;
          canvas.height = canvasHeight;

          const fontSize = Math.min(canvasWidth * 0.1, 100);
          ctx.font = `bold ${fontSize}px Poppins, sans-serif`;

          const textMetrics = ctx.measureText(SHORT_MESSAGE);
          const textWidth = textMetrics.width;

          const x = (canvasWidth - textWidth) / 2;
          const y = canvasHeight * 0.35;

          ctx.fillText(SHORT_MESSAGE, x, y);

          const imageData = ctx.getImageData(0, 0, canvasWidth, canvasHeight);
          const points = [];
          const density = 6;

          for (let row = 0; row < canvasHeight; row += density) {
            for (let col = 0; col < canvasWidth; col += density) {
              if (imageData.data[(row * canvasWidth + col) * 4 + 3] > 128) {
                points.push({ x: col, y: row });
              }
            }
          }
          return points;
        }

        function formShortMessage(targetPoints) {
          const shuffledPoints = [...targetPoints].sort(
            () => 0.5 - Math.random()
          );

          shuffledPoints.forEach((point, index) => {
            const heart = document.createElement("div");
            heart.classList.add("heart-particle");
            heart.innerHTML = "❤️";
            container.appendChild(heart);

            const fromLeft = index % 2 === 0;
            const sticker = fromLeft ? leftSticker : rightSticker;
            const stickerRect = sticker.getBoundingClientRect();
            const startX = stickerRect.left + stickerRect.width / 2;
            const startY = stickerRect.top + stickerRect.height / 2;

            heart.style.left = `${startX}px`;
            heart.style.top = `${startY}px`;

            setTimeout(() => {
              heart.style.opacity = "1";
              heart.style.transform = `translate(${point.x - startX}px, ${
                point.y - startY
              }px)`;
            }, index * 8); // Using your 8ms delay
          });
        }

        function revealLongMessage() {
          longMessageContainer.innerText = LONG_MESSAGE;
          longMessageContainer.classList.add("visible");
        }
      });
    </script>
  </body>
</html>
